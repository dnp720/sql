<html>
 
<script runat="server">
   Platform.Load("core","1");
  var api = new Script.Util.WSProxy();
 
try {
 
    var name = "MyNewQuery";
 
    var request = api.retrieve("QueryDefinition", ["CustomerKey","ObjectID","QueryText","CategoryID"], {
        Property: "CustomerKey", 
        SimpleOperator: "equals",
        Value: "D73AF0AE-86FD-4720-A0E4-DFB9D7325EF8" 
    });

     var objectID = request.Results[0].ObjectID,  
        queryText = request.Results[0].QueryText,
        categoryID = request.Results[0].CategoryID;
 
    var updated_query = queryText + ' where i.userId NOT null ';

    var request = api.retrieve("DataExtension", ["CustomerKey"], {
            Property: "Name",
            SimpleOperator: "equals",
            Value: "CatalogObjectETL_DP_IS"
        });

        var targetKey = request.Results[0].CustomerKey;

    var config = {
        ObjectID: objectID,
        Description: "My updated query",
        CategoryID: categoryID,
        TargetType: "DE",
        TargetUpdateType: "Overwrite",
        QueryText: updated_query,
        DataExtensionTarget: {
            Name: "CatalogObjectETL_DP_IS",
            CustomerKey: targetKey
        }
    };
 
    var result = api.updateItem("QueryDefinition", config); 

    Write("version31.1"+Stringify(result)); 
 
} catch(error) {
 
    Write(Stringify(error));
}
 
</script>
<body>
mark
</body>
</html>
